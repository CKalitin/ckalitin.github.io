---
layout: post
title: "DRAFT DRAFT DRAFT Everything That Went Wrong For UBC Solar At FSGP 2025"
categories: Solar
tags:
    - Ideas
    - Drafts
author:
 - Christopher Kalitin
redirect_from:
  - /solar/2025/07/07/ubc-fsgp-2025.html
word_count: 42069
---
<head>
    <meta property="og:image" content="{{site.url}}/assets/images/nasa-end-state/msr.jpg">
</head>

All notes locations:
1. Docs
2. Apple Notes
3. Laptop Notes
4. Alex Ezzat Messages

Elec issues:
1. Slaveboards
2. MDI / DRD connectors
3. Telemetry issues just before going on the track
4. Motor

Problems in order:  
1. Slave boards  
    a. Balancing in transit?  
    b. isoSPI issues again  
    c. Balancing LEDs not turning on  
    d. Solution? replace board, replace LTC, replace mosfets, resistors too maybe  
2. Wet break testing too slow (A note on integration here and the new break plate)
    a. Rewrite the notes from Alex  
    b. Also, pots
3. MDI connector and inconsistent power / CAN  
    a. Car intermittently wouldn't move for an inexplicable reason  
    b. top shell hitting connector to DRD too  
    c. MDI connector bad  
    d. Tons of attempted motor reflashes to fix it? Fix what?  
4. First drive, motor power wires interferance with rotor of motor  
    a. Wire rubbing and bolt?  
    b. Multiple people heard this  
    c. Motor temperature increased (FET temp?)  
    d. Car stopped moving, after a couple minutes it continued moving  
5. Plastic deposition on motor   
    a. Try to get rid of it with IPA  
6. Get new motor from the University of Toronto  
    a. Break caliper issue comes later  
    b. Attempt to use motor stand from illini? Berkeley?  
    c. Motor initially doesn't work with our controller  
    d. It goes back and forth really quickly  
    e. Try a lot of things with Sasha (great guy)  
    f. it wasn't deterministic interferance  
    g. Give motor LCR specs  
    h. Swap hall effect sense lines around to match motor power phase lines, then it works  
    i. The motor thinks it's in reverse, 10A max, get to track.  
    j. Solve reverse issue after a few hours. (Aarjav pls expand here)  
    k. Now full power on the track! Max 75 kmph!
7. Break calipre issue  
    a. New motor from UofT has a thinner break disc  
    b. Show video  
    c. Break pad(?) falls out and stays there, stuck  
    d. Not constantly breaking on one edge of the break pad(?) and heating up  
    e. Motor FET temperature was also abnormally high  

Going to need a way to share videos here

Write another blog posts on insights from other teams

Write another one (maybe combine) about what to improve about UBC Solar, a vision for UBC Solar in 2028  
What is required for WSC 2028

Maybe write one analyzing data from comp too on Influx

What is the goal of this blog post?  
1. List all issues in technical detail
2. Explain how this is all solvable for next comp

*If you don't do it, no one else will.*

Last summer, during the Formula Sun Grand Prix (FSGP) event in 2024 UBC Solar completed 94 laps (98 minus penalties). This year, we completed 5 official laps (during the first we got stuck at turn 18).

With a car that was already working from last year and a year to improve it, I (and presumably everyone else) expected to either match our previous results or surpass them. Instead, we did about 5% of the year before.

In this blog post I'll describe all the technical issues we faced and broader organizational issues and what we missed in our preparation for competition.

We all pulled several all nighters and solved several seemingly impossible problems and learned a lot from comp. This was absolutely the most fun and rewarding experience of my life, but we did sevearly underperformance our results last year and this is worth examining.

In the next week I'll write a couple more blog posts about comp. First, a summary of everything I learned from other teams, then using this info a vision for the future of UBC Solar, and then a review of FSGP competition data since 2021.

I took 5,211 words of notes during comp and all are available [here](https://github.com/CKalitin/ckalitin.github.io/tree/master/assets/fsgp2025).

### **Competition Preparation Last Year**

The primary issues with UBC Solar's preparation for FSGP 2025 is the lack of paranoia about keeping the car drivable and in a fully working state. 

We raced last year and the car worked extremely well, enough to get 6th place out of 26 teams. This made us complacent about finding and fixing issues throughout the term and instead we made small changes that didn't really improve probability of success during comp.

I'm on the Battery Management Systems (BMS) subteam and my project for 5 months was characterizing the main pack current sensor. In the end, this eliminated at most a 1.5 amp error for a 60 A max battery pack.

This is a nice feature and I [learned](https://ckalitin.github.io/projects/2024/12/27/esp32-adc-characterization.html) a [huge](https://ckalitin.github.io/projects/2024/12/29/scpi-auto-characterization.html) [amount](https://ckalitin.github.io/technical/2025/03/26/stm32-rcc-register.html) about our BMS and firmware programming, but this does not directly increase probability of success during comp (aside from Battery Scrutineering going slightly easier because we don't have to explain to scrutineers that our current sensor is inaccurate).

In contrast, last year UBC Solar went through a mad dash before comp to get the car ready. All major components of the car were assembled just a couple months before competition and we had no spare time to nice-to-haves like an accurate current sensor. This meant the entire focus was getting the car to be successful at competiton, and this year instead the focus was on nice-to-haves until we noticed far too late that the car was not ready (mostly BMS issues, as you'll see later).

My understanding is that our old Electrical lead, Mischa Johal, was particularly instrumental in getting the car ready for comp and he along with the rest of the team worked extremely hard. His blog post [Reflecting On UBC Solar](https://mischajohal.com/Thoughts/Reflecting-on-UBC-Solar) goes into detail about comp in 2024 and is an extremely useful read for anyone on an Solar Car team.

All the members were extremely familiar with the systems in the car prior to FSGP 2024 because they were the ones who built them and scrambled at the end to get it all integrated. This was a great team that put together a car that performed better than UBC Solar ever had. However, only two of the people who went to comp in 2024 went in 2025, Alex Malkowski (Mechanical lead), and Julie Ibrahimova (Previously Battery Mechanical lead and now captain).

This means the team as a whole was less prepared for comp than we were last year, especially since we didn't get the valuable learning experience of frantically getting all the systems working prior to comp like we had in 2024.

### **What 2025 Competition Preparation Should Have Been**

On the last day of competition an observer (observers make sure you don't cheat by charging from the wall or do something too stupid) from ETS (A cracked solar car team), Antoine Lapointe, was observing our team as we debugged the motor before our final laps around the track. I had the opportunity to ask him 38 minutes worth of techical questions.

One of the most important insights was that ETS did 700 kilometers of testing on a track around Montreal before going to the World Solar Challenge this year. In contrast, UBC Solar had under 10 testing days and likely drove under 50 km total. Furthermore, all of our testing was focused on dynamics and not sustained driving. You can imagine that 94 laps around a track is more about sustained driving than dynamics (eg. faster turning and quick breaking).

**AARJAV, JOSHUA!!!!! WHAT DISTANCE DID WE DRIVE IN PRE COMP TESTING????**

**ATTACH AUM VIDEO OF STRESS TESTING**
*The most extreme testing was one of our drivers, Aum, stress testing the cars suspension / wheel wells by (seemingly extremely dangerously) driving in a circle around a parking lot.*

If we had dedicated track days with the car where we aimed to drive 100 km for example, we would have been far more ready for comp.

Furthermore, the issues from comp last year should have been better communicated so that we could know what to expect. Not nice-to-haves, but what went horribly wrong. I don't know exactly what happened last year at comp, but hopefully our next members (recruiting starts in 2 months!) will read this and get a good idea of what to expect and what to watch out for.

Both of these things could have been laid out as goals by our leadership. Fundamentally, a big choice like a 100 km track day can only be made by leadership. If one of the captain, mech lead, or elec lead decided we'd have a track day a month prior to comp we would have been far better prepared for competition (You guys are great, but we should have done better at comp and this is how we do better next time!).

This shows the high leverage impact that great leadership can have. One good decision early on, like decided we'd spend the money to have a track day and attempt 100 km, would have had a huge positive impact for competition.

### **Issue 1: BMS Voltage / Temperature Readings**

**Overview**

![Image]({{site.url}}/assets/images/ubc-fsgp-2025/BMS-architecture.png){: .align-center .width="350"}  
*Our BMS architecture.*

<i>This is a slightly technically complex section in my area of expertise, so notes (see asterisks) are included for those who don't work on Battery Management Systems. I won't describe everything in extreme technical detail and instead focus on conclusions.</i>

Overview:
 - We make our own house Battery Management System (BMS)
 - We use a masterboard-slaveboard-cellboard architecture.
 - Cellboards have a voltage tap on each module and a thermistor.
 - Slaveboards read from cellboards using an LTC6813 microcontroller and send data over isoSPI to the masterboard.
 - The Masterboard aggregates all data and does computations like trigger a fault if we are at too high a temperature.

**Debugging During Comp**

The team arrived to the track on June 30th, the day before srutineering* began. After we got unpacked and I yelled "WE'RE AT COMP!!!" a critical number of times, we began testing the battery. As usual when working with our in-house BMS, this began an all-nighter of solving issues.

<i>* Scrutineering is the process of real engineers scrutinizing your design by asking you technical questions and observer you perform a set of testing on your car and battery pack. Eg. break testing and observing stop time or simulating an over temperature while charging and seeing if your pack actually faults as expected.</i>

**INSERT GRAFANA IMAGE OF MODULE VOLTAGES?**

The first issue we saw is that some module voltage readings* were lower or higher than expected. On modules 21 and 22 we saw anomolous voltage reads that did not match the rest of the modules which were ~4.1 V. Depending on how the wire from the cell board (which holds the thermistor) to the slave board (which has the microcontroller reading voltage and temperature) was bent or if we touched it, we got a different voltage reading. Sometimes a module showed 1V, sometimes it was fine, sometimes it was >~4.1 V. 

<i>* Each module is a parallel line of cells. We have a 32s13p cell configuration with 13 cells in parallel per module and 32 total modules. Temperature and voltage sensing is done through a thermistor and an analog-to-digital (ADC) convertor on the LTC6813 chip we use.</i>

<i>Some more technical details about our battery are available [here](https://x.com/CKalitin/status/1939421548890448380).</i>

We also noticed that one modules was ~0.12 V lower than the rest of the modules. As you can see in our [open source firmware](https://github.com/UBC-Solar/firmware_v3/blob/master/components/bms/bms_master/Core/Src/balancing.c), whenever there is greater than a 50mV difference between module voltage, we enable balancing resistors which dissipate excess energy from the modules that have too high voltage. This is the practice of passive pack balancing.

Our theory for why this happened is that somehow the MOSFET that toggles the balancing resistor was enabled during transport to competition and that one module was dissipating energy at some points during transport. After doing some quick math, it seemed that it would have been balancing for 5 total hours.

After replugging in all of the cellboard-to-slaveboard wire harnesses, replugging the isoSPI wire from the BMS masterboard to slaveboard and poking around the pack we came to the conclusion that we had several distinct issues. 

1. Touching the isoSPI wire harness between the masterboard and slaveboard 1 resulted in different data
2. Touching the slaveboards at certain points resulted in different data
3. Touching the slaveboard-cellboard wire harness sometimes resulted in different data

Our process for solving this issue involved replacing one of our slaveboards with a replacement we brought up before competition. Replacing it again with a mostly complete (missing LTC6813 micro controller) slave board again. Replacing one of the MOSFETs that toggle the balancing resistor. And swapping out the slaveboard-cellboard wire harnesses and masterboard-slaveboard isoSPI wire a few times.

We did all of this debugging during an all-nighter (I got soft and slept 90 minutes) in a frantic attempt to get the pack working for scrutineering the morning after so I likely got a few details wrong. Please correct me if I'm wrong anywhere here.

**We Saw These Issues For Months Before Comp**

Several months before competition the team began to shift focus from making small improvements to the car to getting it into a drivable state. As this campaign began and continued, we had endless issues with our in-house BMS, many of which remanifested themselves during competition. 

**IMAGE OF WIRES**

**IMAGE OF STRATEGY MAKING FUN OF CRIMPING WIRES**

The quality of the crimps on the slaveboard-cellboard wire harness has been an issue for months and something we encountered again during competition. This is an unsolved problem and has delayed the car working for a non-trivial amount of time during competition. For the next generation we'll likely swap the connectors we're using from these [small shitty Molex 8 pos connectors](https://www.digikey.ca/en/products/detail/molex/0353630860/755312?s=N4IgTCBcDaIMwFY4DY4AYAcy0gLoF8g) to some nicer big Molex Minifit ones.

Frying LTC6813 chips through either [putting the module voltage tap jumpers on in the wrong order](https://x.com/CKalitin/status/1939023392100782253) or ESD or other forms of operator error has set us back several weeks at minimum. If any future BMS member are reading this, think long and hard about your slaveboard design and failure modes, edge cases, and opportunities for operator error. You're likely working on the most inscrutible board in the entire car, or even the entire UBC engineering design team building. Ensure you build your board good enough that members in 3 years won't have months of issues.

In the end, we did finally get the BMS into a state where it worked well enough for the purposes of scrutineering and driving the car. I'm not sure anyone on the team fully understands the issues we faced from first principles and knows how to fully solve this for future generations of our car. The conclusion here is that every future BMS member has to be horribly paranoid about the edge cases in which their firmware or hardware doesn't work.

### **Issue 2: Failing Wet Break Testing A Few Times & Breaking The Accelerator Potentiometer**

<i>Details in this section mainly come from Alex Malkovski, our Mechanical Lead. Notes [available here](https://github.com/CKalitin/ckalitin.github.io/blob/master/assets/fsgp2025/alexcomp.md).</i>

2. Wet break testing too slow (A note on integration here and the new break plate)
    a. Rewrite the notes from Alex  
    b. Also, pots

**OBV INSERT IMAGE OR VIDEO**

Wet Break Testing involves accelerating your car to ~30 mph, then breaking to a stop while on wet ground. The first day we attempted this we failed due to taking too long to break, or the car going out of control (hydroplaning such that the cars angle to the velocity vector was ~30 degrees).

In short, the issues were that a new untested breakplate pinched a breakline and caused interferance with a wire going to the accelerator's potentiometer which ended up shearing the wire.

In the final couple of weeks before driving to competition, the mechanical team scrambled to instead a new base plate which the break and accelerator pedals are mounted to. This base plate was installed on the Sunday before competition, we began driving on Wednesday morning.

Alex (Mech lead) was prepared to not install this new base plate before comp because of issues manufacturing it and how short notice it was. 

The part was designed such that it required a CNC machine for machining on both sides and different fillet radii so multiple tool changes were required.

Our previous mechanical lead, Liam Andrew, is (was? graduated?) a student in the Integrated Engineering (IGEN) faculty of UBC. He was the only one on the team with access to a CNC machine in the IGEN shop.

This means manufacturing was complicated and delayed, since Liam Andrew is no longer an active member on the team. He had to come back last minute to finish up this project.

After the new baseplate was installed we only had one driving day on Monday before we left for comp. It was only at comp that we noticed that one of the breaklines was pinched between the master cylinder mount and a tab that holds the base plate. This was only noticed after a couple hours of dynamics testing at competition when the vehicle dynamics team was inspecting the car.

I believe the solution was rerouting the breakline.

**POT IMAGE**

The second issue due to the new base plate was interferance between a spring on the break pedal (i think) and the wire that comes from the accelerator potentiometer.

This potentiometer is how we know how far the accelerator pedal is pressed, and hence is criticial comp hardware. So it was a critical issue when the wire to this potentiometer was severed.


